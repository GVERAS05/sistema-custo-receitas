<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Calculadora de Custos da Receita</title>

<style>
body { font-family: Arial; padding: 20px; }
input, select, button { padding: 4px; margin: 2px; }
table { border-collapse: collapse; width: 100%; margin-top: 10px; }
th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
ul { border: 1px solid #ccc; max-height: 150px; overflow-y: auto; padding: 0; margin-top: 5px; }
li { list-style: none; padding: 6px; cursor: pointer; }
li:hover { background: #eee; }
button { cursor: pointer; }
.total { font-weight: bold; font-size: 18px; margin-top: 10px; }
</style>
</head>

<body>

<h2>Buscar item</h2>
<input type="text" placeholder="Digite para buscar..." onkeyup="buscar(this.value)">
<ul id="lista"></ul>

<h2>Receita</h2>
<table>
<thead>
<tr>
  <th>Item</th>
  <th>Custo por unidade (R$)</th>
  <th>Quantidade usada</th>
  <th>Unidade</th>
  <th>Custo do item (R$)</th>
  <th>Remover</th>
</tr>
</thead>
<tbody id="tabelaItens"></tbody>
</table>

<p class="total">Custo total da receita: R$ <span id="total">0.00</span></p>

<script>
// ===== INGREDIENTES =====
const ingredientes = [
  "Açúcar Refinado","Farinha de Trigo","Sal","Óleo de Soja","Fermento",
  "Amido de Milho","Cacau em Pó","Chocolate em Pó","Margarina",
  "Manteiga","Leite","Coco","Aroma","Embalagem","Caixa de Papelão"
].sort();

// ===== UNIDADES =====
const unidades = [
  { label: "Unidade", value: "un" },
  { label: "Quilo (kg)", value: "kg" },
  { label: "Grama (g)", value: "g" },
  { label: "Litro (L)", value: "L" },
  { label: "Mililitro (ml)", value: "ml" }
];

// ===== LUPA / PESQUISA =====
const lista = document.getElementById("lista");
let itensAdicionados = {};

function buscar(txt){
  lista.innerHTML = "";
  if(!txt) return;
  ingredientes.filter(i => i.toLowerCase().includes(txt.toLowerCase()))
            .forEach(i => {
    const li = document.createElement("li");
    li.textContent = i;
    li.onclick = () => adicionarItem(i);
    lista.appendChild(li);
  });
}

// ===== ADICIONAR ITEM =====
function adicionarItem(nome){
  if(itensAdicionados[nome]) return; // só uma vez
  itensAdicionados[nome] = true;

  const tbody = document.getElementById("tabelaItens");
  const tr = document.createElement("tr");
  tr.dataset.nome = nome;

  tr.innerHTML = `
    <td>${nome}</td>
    <td><input type="number" step="0.01" oninput="calcular()"></td>
    <td><input type="number" step="0.001" oninput="calcular()"></td>
    <td>
      <select onchange="calcular()">
        ${unidades.map(u => `<option value="${u.value}">${u.label}</option>`).join("")}
      </select>
    </td>
    <td class="custo">0.00</td>
    <td><button onclick="removerItem(this)">❌</button></td>
  `;

  tbody.appendChild(tr);
  lista.innerHTML = ""; // limpa lista depois de adicionar
  document.querySelector('input[placeholder]').value = ""; // limpa pesquisa
}

// ===== CALCULAR =====
function calcular(){
  let total = 0;
  document.querySelectorAll("#tabelaItens tr").forEach(tr => {
    const custoUnit = parseFloat(tr.children[1].children[0].value) || 0;
    const quantidade = parseFloat(tr.children[2].children[0].value) || 0;
    const subtotal = custoUnit * quantidade;
    tr.querySelector(".custo").textContent = subtotal.toFixed(2);
    total += subtotal;
  });
  document.getElementById("total").textContent = total.toFixed(2);
}

// ===== REMOVER ITEM =====
function removerItem(botao){
  const tr = botao.closest("tr");
  delete itensAdicionados[tr.dataset.nome];
  tr.remove();
  calcular();
}
</script>

</body>
</html>
